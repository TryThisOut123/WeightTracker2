<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Richard's Weight Tracker</title>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Date adapter for Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>

  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect width='180' height='180' fill='%2390EE90'/><text x='90' y='75' font-family='Arial, sans-serif' font-size='60' font-weight='bold' fill='white' text-anchor='middle'>RS</text><text x='90' y='135' font-family='Arial, sans-serif' font-size='60' font-weight='bold' fill='white' text-anchor='middle'>WT</text></svg>">
  <link rel="manifest" href='data:application/manifest+json,{"name":"Richard Tracker","short_name":"RS WT","icons":[{"src":"data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 180 180\"><rect width=\"180\" height=\"180\" fill=\"%2390EE90\"/><text x=\"90\" y=\"75\" font-family=\"Arial\" font-size=\"60\" font-weight=\"bold\" fill=\"white\" text-anchor=\"middle\">RS</text><text x=\"90\" y=\"135\" font-family=\"Arial\" font-size=\"60\" font-weight=\"bold\" fill=\"white\" text-anchor=\"middle\">WT</text></svg>","sizes":"180x180","type":"image/svg+xml"}],"display":"standalone","background_color":"#90EE90"}'>
  
  <style> 
    body { font-family: Arial, sans-serif; background: #f5f7fb; margin:0; padding:20px; }
    .container { max-width:600px; margin:0 auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
    h1 { text-align:center; }
    .input-row { display:flex; gap:10px; margin-bottom:10px; }
    input[type=date], input[type=number] { flex:1; padding:8px; border-radius:5px; border:1px solid #ccc; }
    button { padding:8px 12px; border:none; border-radius:5px; background:#347ab7; color:white; cursor:pointer; }
    button:hover { opacity:0.9; }
    .filters { display:flex; gap:8px; flex-wrap:wrap; margin:10px 0; }
    .filter { padding:6px 10px; border-radius:20px; border:1px solid transparent; cursor:pointer; }
    .filter.active { background:#347ab7; color:white; }
    canvas { width:100%; height:300px; }
    .entry-list { max-height:150px; overflow:auto; margin-top:10px; }
    .entry { display:flex; justify-content:space-between; padding:5px 0; border-bottom:1px solid #eee; }
    .entry button { background:transparent; color:#347ab7; padding:0; border:none; cursor:pointer; font-weight:bold; }
  </style>
</head>
<body>
<div class="container">
  <h1>Richard's Weight Tracker</h1>
  <div class="input-row">
    <input id="dateInput" type="date">
    <input id="weightInput" type="number" step="0.1" placeholder="Weight">
    <button id="saveBtn">Save</button>
  </div>
  <div class="filters">
    <button class="filter active" data-filter="week">Week</button>
    <button class="filter" data-filter="month">1Mo</button>
    <button class="filter" data-filter="2month">2Mo</button>
    <button class="filter" data-filter="ytd">YTD</button>
    <button class="filter" data-filter="lastyear">Last Yr</button>
    <button class="filter" data-filter="all">All</button>
  </div>
  <canvas id="chart"></canvas>
  <div class="entry-list" id="entryList"></div>
  <div style="margin-top:10px; display:flex; gap:10px;">
    <button id="exportBtn">Export CSV</button>
    <button id="importBtn">Import CSV</button>
    <div style="margin-top:10px;">
      <button id="resetBtn" style="background:#b73535;">Reset Data</button>
    </div>

    <!-- Confirmation panel (hidden by default) -->
    <div id="confirmPanel" 
         style="display:none; margin-top:15px; padding:15px; 
            border:1px solid #ccc; border-radius:10px; background:#fff0f0;">
      <div style="margin-bottom:10px; font-weight:bold;">
        Delete ALL data? This cannot be undone.
      </div>
    <button id="confirmReset" style="background:#b73535; margin-right:10px;">Confirm</button>
    <button id="cancelReset">Cancel</button>
  </div>
  
    <input id="fileInput" type="file" accept="text/csv" style="display:none">
  </div>
</div>

<script>
const STORAGE_KEY = 'rwt_entries_v1';
let entries = [];

const dateInput = document.getElementById('dateInput');
const weightInput = document.getElementById('weightInput');
const saveBtn = document.getElementById('saveBtn');
const entryList = document.getElementById('entryList');
const filters = document.querySelectorAll('.filter');
const exportBtn = document.getElementById('exportBtn');
const importBtn = document.getElementById('importBtn');
const fileInput = document.getElementById('fileInput');
const ctx = document.getElementById('chart').getContext('2d');

function todayISO(){
  const d = new Date();
  const tzOffset = d.getTimezoneOffset()*60000;
  return new Date(d-tzOffset).toISOString().slice(0,10);
}

dateInput.value = todayISO();

let chart = new Chart(ctx, {
  type: 'line',
  data: { labels: [], datasets: [{ label: 'Weight', data: [], fill:false, tension:0.25 }] },
  options: {
    responsive:true,
    scales:{ 
      x:{ type:'time', time:{ unit:'day', tooltipFormat:'MMM dd, yyyy' } },
      y:{ beginAtZero:false }
    },
    plugins:{legend:{display:false}}
  }
});

function load(){
  const raw = localStorage.getItem(STORAGE_KEY);
  entries = raw ? JSON.parse(raw) : [];
}
function saveLocal(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
}
function addOrUpdate(date, weight){
  const idx = entries.findIndex(e=>e.date===date);
  if(idx>=0) entries[idx].weight = weight;
  else entries.push({date,weight});
  entries.sort((a,b)=>a.date.localeCompare(b.date));
  saveLocal(); render();
}
function removeEntry(date){
  entries = entries.filter(e=>e.date!==date);
  saveLocal(); render();
}
function renderList(){
  entryList.innerHTML='';
  const sorted = [...entries].reverse();
  if(sorted.length===0){ entryList.innerHTML='<div>No entries yet</div>'; return }
  for(const e of sorted){
    const div = document.createElement('div'); div.className='entry';
    div.innerHTML = `<div>${e.date}: ${e.weight} lbs</div>`;
    const del = document.createElement('button'); del.textContent='Delete'; del.onclick=()=>removeEntry(e.date);
    div.appendChild(del);
    entryList.appendChild(div);
  }
}
function getFilteredEntries(filter){
  const now = new Date();
  if(filter==='all') return entries;
  if(filter==='week'){ const start = new Date(); start.setDate(now.getDate()-6); return entries.filter(e=>new Date(e.date)>=start); }
  if(filter==='month'){ const start = new Date(); start.setMonth(now.getMonth()-1); return entries.filter(e=>new Date(e.date)>=start); }
  if(filter==='2month'){ const start = new Date(); start.setMonth(now.getMonth()-2); return entries.filter(e=>new Date(e.date)>=start); }
  if(filter==='ytd'){ const start = new Date(now.getFullYear(),0,1); return entries.filter(e=>new Date(e.date)>=start); }
  if(filter==='lastyear'){ const start = new Date(); start.setFullYear(now.getFullYear()-1); return entries.filter(e=>new Date(e.date)>=start); }
  return entries;
}
function renderChart(filter='week'){
  const data = getFilteredEntries(filter);
  chart.data.labels = data.map(d => new Date(d.date));  // convert to Date objects
  chart.data.datasets[0].data = data.map(d => d.weight);
  chart.update();
}
function render(){ renderList(); const active = document.querySelector('.filter.active')?.dataset.filter || 'week'; renderChart(active); }

load(); render();

saveBtn.addEventListener('click', ()=>{
  const date=dateInput.value; const weight=parseFloat(weightInput.value);
  if(!date || isNaN(weight)) return;
  addOrUpdate(date,weight);
  weightInput.value='';
});
filters.forEach(f=>f.addEventListener('click', ()=>{
  filters.forEach(x=>x.classList.remove('active'));
  f.classList.add('active');
  renderChart(f.dataset.filter);
}));
exportBtn.addEventListener('click', ()=>{
  if(entries.length===0) return;
  const csv = 'date,weight\n'+entries.map(e=>`${e.date},${e.weight}`).join('\n');
  const blob = new Blob([csv],{type:'text/csv'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='weight-export.csv'; a.click();
});
importBtn.addEventListener('click', ()=>fileInput.click());
fileInput.addEventListener('change',(ev)=>{
  const file=ev.target.files[0]; if(!file) return;
  const reader=new FileReader(); reader.onload=()=>{
    const rows=reader.result.split('\n').slice(1);
    rows.forEach(r=>{ const [d,w]=r.split(','); const weight=parseFloat(w); if(d && !isNaN(weight)) addOrUpdate(d,weight); });
  };
  reader.readAsText(file);
});
weightInput.addEventListener('keydown',(e)=>{if(e.key==='Enter') saveBtn.click();});
// RESET DATA FEATURE
const resetBtn = document.getElementById('resetBtn');
const confirmPanel = document.getElementById('confirmPanel');
const confirmReset = document.getElementById('confirmReset');
const cancelReset = document.getElementById('cancelReset');

// Show confirm panel
resetBtn.addEventListener('click', () => {
  confirmPanel.style.display = 'block';
});

// Cancel reset
cancelReset.addEventListener('click', () => {
  confirmPanel.style.display = 'none';
});

// Confirm reset
confirmReset.addEventListener('click', () => {
  localStorage.removeItem(STORAGE_KEY);
  entries = [];
  render();

  confirmPanel.style.display = 'none';
});
  
</script>
</body>
</html>










